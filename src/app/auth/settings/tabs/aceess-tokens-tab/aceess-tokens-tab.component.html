<ng-container
    *ngIf="currentCreateStep === TokenCreateStep.INITIAL"
    [ngTemplateOutlet]="createTokenTemplate"
    [ngTemplateOutletContext]="{ $implicit: TokenCreateStep.INITIAL }"
>
</ng-container>

<ng-container *ngIf="currentCreateStep === TokenCreateStep.GENERATE">
    <h2>New personal access token</h2>
    <mat-divider></mat-divider>
    <p class="text-muted mt-3">Personal access tokens  can be used instead of a password for Kamu over HTTPS</p>
    <form class="mt-60" [formGroup]="createTokenForm" (ngSubmit)="onGenerateToken()">
        <label for="token-name" class="form-label">Name</label>
        <div class="d-flex align-items-center">
            <input class="form-control w-300" id="token-name" formControlName="name" />
        </div>
        <div class="mt-4">
            <button
                (click)="onGenerateToken()"
                type="button"
                class="generate-token-btn"
                [disabled]="!createTokenForm.valid"
                data-test-id="create-dataset"
            >
                Generate token
            </button>
            <button (click)="onCancel()" type="button" class="btn btn-light ms-4">Cancel</button>
        </div>
    </form>
</ng-container>

<ng-container
    *ngIf="currentCreateStep === TokenCreateStep.FINISH"
    [ngTemplateOutlet]="createTokenTemplate"
    [ngTemplateOutletContext]="{ $implicit: TokenCreateStep.FINISH }"
>
</ng-container>

<ng-template #createTokenTemplate let-currentStep>
    <h2>Access tokens</h2>
    <mat-divider></mat-divider>
    <p class="text-muted mt-3">
        Learn how to
        <a href="https://docs.kamu.dev/cli/cli-reference/#kamu-system-generate-token" target="_blank"
            >generate access token</a
        >
    </p>
    <div class="d-flex justify-content-between align-items-center mt-60">
        <button (click)="addNewToken()" class="new-token-button d-flex justify-content-between align-items-center">
            <mat-icon class="text-muted fs-4 d-block pt-2px pe-1">add</mat-icon>
            <span class="fs-12 me-2 d-block"> New token</span>
        </button>
        <div class="text-center position-relative align-items-center">
            <input
                class="form-control placeholder-padding-left"
                type="text"
                autocomplete="off"
                placeholder="Search by name"
                [(ngModel)]="searchTokenName"
            />
            <svg-icon name="search"></svg-icon>
            <mat-icon
                *ngIf="searchTokenName"
                (click)="refreshSearchByName()"
                class="fs-5 d-inline position-absolute close-position"
                >close</mat-icon
            >
        </div>
    </div>
    <div *ngIf="currentStep === TokenCreateStep.FINISH" class="mb-4 mt-30 d-flex flex-column align-items-center">
        <div class="alert alert-primary text-center w-75" role="alert">
            Make sure to copy your personal access token now. You won’t be able to see it again!
        </div>
        <div
            class="alert alert-light w-75 mt-2 border-dashed d-flex align-items-center justify-content-between"
            role="alert"
        >
            <div class="d-flex align-items-center">
                <input type="text" class="form-control fs-12 w-300" data-autoselect="" #clipboardToken readonly />
                <div class="input-group-button ms-1">
                    <button
                        (click)="copyToClipboard($event, clipboardToken.value)"
                        data-test-id="copyToClipboard"
                        aria-label="Copy to clipboard"
                        class="copy-button ms-1"
                        data-copy-feedback="Copied!"
                        tabindex="0"
                        role="button"
                    >
                        <div style="position: relative; display: inline-block">
                            <svg-icon name="copy"></svg-icon>
                        </div>
                        <div style="position: relative; display: none">
                            <svg-icon name="checked"></svg-icon>
                        </div>
                    </button>
                </div>
            </div>
            <div>
                <button class="delete-token-button">
                    <mat-icon class="fs-4">delete</mat-icon>
                </button>
            </div>
        </div>
    </div>
    <div class="content-table mt-4">
        <table mat-table [dataSource]="dataSource" class="w-100 tokens-table" matSort>
            <!-- Name Column -->
            <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Token name</th>
                <td mat-cell *matCellDef="let element">{{ element.name }}</td>
            </ng-container>

            <!-- Added Column -->
            <ng-container matColumnDef="added">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Added</th>
                <td mat-cell *matCellDef="let element">{{ element.added }}</td>
            </ng-container>

            <!-- Last used Column -->
            <ng-container matColumnDef="last_used">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Last used</th>
                <td mat-cell *matCellDef="let element">{{ element.last_used }}</td>
            </ng-container>

            <!-- Actions Column -->
            <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef></th>
                <td mat-cell *matCellDef="let element; let i = index">
                    <button class="delete-token-button" (click)="deleteToken(i)">
                        <mat-icon class="fs-4 pt-1">delete</mat-icon>
                    </button>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="DISPLAY_COLUMNS"></tr>
            <tr mat-row *matRowDef="let row; columns: DISPLAY_COLUMNS"></tr>
        </table>
    </div>
    <div class="mt-60">
        <app-pagination
            *ngIf="dataSource.data.length"
            [currentPage]="currentPage - 1"
            [pageInfo]="pageBasedInfo"
        ></app-pagination>
    </div>
</ng-template>
