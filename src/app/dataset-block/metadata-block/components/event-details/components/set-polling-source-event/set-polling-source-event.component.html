<div class="d-flex justify-content-end">
    <span class="me-2">Show as yaml</span>
    <app-toggle
        [isToggled]="isYamlView"
        (toggled)="onToggleView($event)"
    ></app-toggle>
</div>

<div *ngIf="isYamlView" class="layout lh-1 font-monospace mt-4">
    <p class="color-key">fetch:</p>
    <p>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kind:
        <span class="value-color">
            {{ event.fetch.__typename }}
        </span>
    </p>
    <ng-container *ngIf="fetchStepUrl">
        <p>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;url:
            <a [href]="fetchStepUrl.url" [title]="fetchStepUrl.url"
                ><span class="value-color lh-sm">{{
                    fetchStepUrl.url
                }}</span></a
            >
        </p>
        <p *ngIf="fetchStepUrl.eventTime">
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eventTime:
        </p>
    </ng-container>
    <ng-container *ngIf="isFetchStepFilesGlob">
        <p>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;path:
            <span class="value-color">{{ fetchStepFilesGlob.path }}</span>
        </p>
    </ng-container>
    <p class="color-key">read:</p>
    <p>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kind:
        <span class="value-color">{{ event.read.__typename }}</span>
    </p>
    <ng-container *ngIf="isReadStepCsv">
        <p>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;separator:
            <span class="value-color"> "{{ readStepCsv.separator }}"</span>
        </p>
        <p>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;header:
            <span class="value-color"> {{ readStepCsv.header }}</span>
        </p>
    </ng-container>
    <p class="color-key">merge:</p>
    <ng-container *ngIf="isMergeStrategyLedger">
        <p>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kind:
            <span class="value-color"> {{ event.merge.__typename }}</span>
        </p>
        <p>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;primaryKey:
            <span class="value-color">
                {{ mergeStrategyLedger.primaryKey.join(", ") }}</span
            >
        </p>
    </ng-container>

    <ng-container *ngIf="event.preprocess">
        <p class="color-key">preprocess:</p>
        <p>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kind:
            <span class="value-color"> {{ event.preprocess.__typename }}</span>
        </p>

        <p>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;engine:
            <span class="value-color"> {{ event.preprocess.engine }}</span>
        </p>

        <p *ngIf="event.preprocess.version">
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;version:
            <span class="value-color"> {{ event.preprocess.version }}</span>
        </p>

        <ng-container *ngIf="event.preprocess.queries">
            <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;queries:</p>
            <ng-container *ngFor="let query of event.preprocess.queries">
                <p>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- alias:<span
                        class="value-color"
                    >
                        {{ query.alias ? query.alias : "none" }}</span
                    >
                </p>
                <p>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; query:<span
                        class="value-color lh-sm"
                    >
                        {{ query.query }}</span
                    >
                </p>
            </ng-container>
        </ng-container>
    </ng-container>
</div>

<ng-container *ngIf="!isYamlView">
    <div class="d-flex flex-column gap-4 mt-4">
        <div
            class="position-relative border border-1 p-2 rounded-3"
            *ngFor="let section of eventSections"
        >
            <span
                class="position-absolute text-muted group-box-label text-uppercase"
                >{{ section.title }}</span
            >
            <div class="mx-4">
                <ng-container *ngFor="let row of section.rows">
                    <app-block-row-data
                        *ngIf="
                            !row.separateRowForValue;
                            else templateSeparateRow
                        "
                        [tooltip]="row.tooltip"
                        [label]="row.label"
                    >
                        <ng-template #container></ng-template>
                    </app-block-row-data>
                    <ng-template #templateSeparateRow>
                        <app-block-row-data
                            [tooltip]="row.tooltip"
                            [label]="row.label"
                        >
                        </app-block-row-data>
                        <ng-template #container></ng-template>
                    </ng-template>
                </ng-container>
            </div>
        </div>
    </div>
</ng-container>
