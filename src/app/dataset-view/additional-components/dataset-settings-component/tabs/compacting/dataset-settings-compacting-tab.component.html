<div class="w-75 content-container">
    <h2>Compacting</h2>
    <mat-divider class="mt-1 mb-2"></mat-divider>

    <div class="box p-4 mt-3">
        <h4 class="subtitle">Hard compaction</h4>
        <form [formGroup]="hardCompactionForm">
            <div class="row">
                <div class="col-md-3">
                    <div class="d-flex align-items-center pt-1">
                        <app-tooltip-icon class="mt-1" [tooltip]="MAX_SLICE_SIZE_TOOLTIP"></app-tooltip-icon>
                        <span class="d-inline-block">Max slice size:</span>
                    </div>
                </div>
                <div class="col-md-9 d-flex">
                    <select class="form-select me-4 form-control-width" formControlName="sliceUnit">
                        <option [value]="SliceUnit.B">B</option>
                        <option [value]="SliceUnit.KB">KB</option>
                        <option [value]="SliceUnit.MB">MB</option>
                        <option [value]="SliceUnit.GB">GB</option>
                    </select>
                    <input type="number" min="1" class="form-control form-control-width" formControlName="sliceSize" />
                    <ng-container
                        *ngIf="
                            hardCompactionForm?.get('sliceSize')?.errors?.minNumber &&
                            (hardCompactionForm.get('sliceSize')?.touched || hardCompactionForm.get('sliceSize')?.dirty)
                        "
                    >
                        <span
                            class="text-danger ms-4 fs-12 d-flex align-items-end text-break"
                            data-test-id="slice-size-error"
                        >
                            The value must be positive
                        </span>
                    </ng-container>
                </div>
            </div>

            <div class="row mt-4">
                <div class="col-md-3">
                    <div class="d-flex align-items-center pt-1">
                        <app-tooltip-icon class="mt-1" [tooltip]="MAX_SLICE_RECORDS_TOOLTIP"></app-tooltip-icon>
                        <span class="d-inline-block">Max slice records:</span>
                    </div>
                </div>
                <div class="col-md-9 d-flex">
                    <input
                        type="number"
                        min="1"
                        class="form-control form-control-width"
                        formControlName="recordsCount"
                    />
                    <ng-container
                        *ngIf="
                            hardCompactionForm?.get('recordsCount')?.errors?.minNumber &&
                            (hardCompactionForm.get('recordsCount')?.touched ||
                                hardCompactionForm.get('recordsCount')?.dirty)
                        "
                    >
                        <span
                            class="text-danger ms-4 fs-12 d-flex align-items-end text-break"
                            data-test-id="slice-size-error"
                        >
                            The value must be positive
                        </span>
                    </ng-container>
                </div>
            </div>

            <div class="d-flex action-area justify-content-between align-items-center mt-4">
                <div class="description">
                    Hard compactions rewrite the history of the dataset as if data was originally written in big
                    batches. Hard compactions will rewrite the metadata chain, changing block hashes. Therefore, they
                    will
                    <strong>break all downstream datasets</strong> that depend on them.
                </div>
                <button
                    (click)="onRunCompaction()"
                    [disabled]="hardCompactionForm.invalid"
                    class="d-block"
                    type="button"
                >
                    Run compaction
                </button>
            </div>
        </form>
    </div>
</div>
