<h2>General</h2>
<mat-divider class="mt-1 w-75 mb-2"></mat-divider>
<form [formGroup]="renameDatasetForm">
    <dl class="form-group d-inline-block mt-3 mb-0">
        <dt class="input-label mb-2">
            <label for="rename-field" [class.error-color]="renameError$ | async">Dataset name</label>
        </dt>
        <dd>
            <input
                formControlName="datasetName"
                type="text"
                name="new_name"
                class="form-control"
                id="rename-field"
                data-test-id="rename-dataset-input"
                (keyup)="changeName()"
                [class.error-border-color]="renameError$ | async"
            />
        </dd>
    </dl>
    <button
        class="ms-4 rename-btn"
        type="button"
        (click)="renameDataset()"
        [disabled]="!renameDatasetForm.valid"
        data-test-id="rename-dataset-button"
    >
        Rename
    </button>
    <div *ngIf="datasetNameControl.invalid && (datasetNameControl.touched || datasetNameControl.dirty)">
        <span
            *ngIf="datasetNameControl.errors?.required"
            class="text-danger fs-12"
            data-test-id="rename-dataset-error-name-required"
            >Name is required</span
        >
        <span
            *ngIf="datasetNameControl.errors?.pattern"
            class="text-danger fs-12"
            data-test-id="rename-dataset-error-name-pattern"
            >Invalid dataset name</span
        >
    </div>
    <div *ngIf="renameError$ | async as renameError">
        <div class="error-block" data-test-id="rename-dataset-error-custom">{{ renameError }}</div>
    </div>
</form>
<div class="mt-2 margin-bottom">
    <h2>Danger Zone</h2>
    <div class="danger-zone__content d-flex justify-content-between align-items-center w-75 mt-4">
        <div class="danger-zone__description">
            <p class="description">Reset this dataset</p>
            <p class="hint mt-2">
                This operation will discard all blocks of the dataset except the very first (Seed) block, thus erasing
                all data and history of changes and preserving only the dataset's identity. This will break all the
                downstream consumers, so use this only in extreme cases.
            </p>
            <form class="row" [formGroup]="resetDatasetForm">
                <div class="d-flex flex-row">
                    <div class="d-flex align-items-center pt-1 hint">
                        <mat-radio-group class="d-flex flex-column row-gap-2" formControlName="mode" color="primary">
                            <!-- <mat-radio-button [value]="pollingGroupEnum.TIME_DELTA"> -->
                            <mat-radio-button [value]="DatasetResetMode.RESET_TO_SEED">
                                <div class="d-flex align-items-center">
                                    Reset to seed
                                    <app-tooltip-icon class="ps-2 pt-1" [tooltip]="SEED_TOOLTIP"></app-tooltip-icon>
                                </div>
                            </mat-radio-button>
                            <mat-radio-button [value]="DatasetResetMode.RESET_METADATA_ONLY">
                                <div class="d-flex align-items-center">
                                    Reset metadata only
                                    <app-tooltip-icon
                                        class="ps-2 pt-1"
                                        [tooltip]="FLATTEN_METADATA_TOOLTIP"
                                    ></app-tooltip-icon>
                                </div>
                            </mat-radio-button>
                        </mat-radio-group>
                        <!-- <app-tooltip-icon class="mt-1" [tooltip]="FLATTEN_METADATA_TOOLTIP"></app-tooltip-icon>
                        <span class="d-inline-block">Flatten metadata:</span>
                        <input
                            class="form-check-input recursive-control d-inline-block ms-3"
                            type="checkbox"
                            (change)="changeFlattenMetadata()"
                            [(ngModel)]="flattenMetadata"
                        /> -->
                    </div>
                    <div class="d-flex align-items-center pt-1 ms-4">
                        <app-tooltip-icon class="mt-1" [tooltip]="RECURSIVE_TOOLTIP"></app-tooltip-icon>
                        <span class="d-inline-block">Recursive:</span>
                        <input
                            class="form-check-input recursive-control d-inline-block ms-3"
                            type="checkbox"
                            formControlName="recursive"
                        />
                    </div>
                </div>
            </form>
        </div>
        <button type="button" data-test-id="reset-dataset-button" (click)="resetDataset()">Reset this dataset</button>
    </div>

    <div class="danger-zone__content d-flex justify-content-between align-items-center w-75 mt-4">
        <div class="danger-zone__description">
            <p class="description">Delete this dataset</p>
            <p class="hint mt-2">
                Removes the dataset from the node, potentially losing all data and history. Note that the dataset may
                still remain replicated or cached by other nodes in the network.
            </p>
        </div>
        <button
            type="button"
            [disabled]="isDeleteDatasetDisabled"
            (click)="deleteDataset()"
            data-test-id="delete-dataset-button"
        >
            Delete this dataset
        </button>
    </div>
</div>
