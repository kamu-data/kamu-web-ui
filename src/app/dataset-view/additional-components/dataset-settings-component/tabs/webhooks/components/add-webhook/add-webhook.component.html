<h2>Webhooks/Add subscription</h2>
<div class="box p-4">
    <form [formGroup]="createOrEditSubscriptionForm">
        <div class="d-flex flex-column mt-4">
            <label for="" class="form-label">Target URL <span class="text-danger">*</span></label>
            <input
                type="text"
                data-test-id="target-url"
                formControlName="targetUrl"
                class="w-100 form-control"
                #targetUrl
                [readOnly]="isSecretExist"
            />
            <div
                class="text-danger fs-12"
                [input]="targetUrl"
                [fieldLabel]="'Target URL'"
                [appFieldError]="ErrorSets.TargetUrl"
                [group]="createOrEditSubscriptionForm"
            ></div>

            <p class="text-muted fs-12">
                Must be publicly reachable via HTTPS. Localhost and private Ips are not allowed
            </p>
        </div>
        <div class="d-flex flex-column mt-4">
            <label for="" class="form-label">Subscribed events <span class="text-danger">*</span></label>
            <ng-select
                [items]="dropdownList"
                bindLabel="name"
                bindValue="value"
                formControlName="eventTypes"
                [multiple]="true"
                [readonly]="isSecretExist"
                #eventTypes
            >
                <ng-template ng-option-tmp let-item="item" let-index="index">
                    <label class="fs-14 inline-block"> {{ item.name }} </label>
                </ng-template>
            </ng-select>
            <div
                class="text-danger fs-12"
                [input]="eventTypes"
                [fieldLabel]="'Event selection'"
                [appFieldError]="'required'"
                [fieldControl]="createOrEditSubscriptionForm.get('eventTypes')"
                [group]="createOrEditSubscriptionForm"
            ></div>
        </div>
        <div class="d-flex flex-column mt-4">
            <label for="" class="form-label">Label </label>
            <input
                #label
                type="text"
                [readOnly]="isSecretExist"
                data-test-id="target-url"
                formControlName="label"
                class="w-100 form-control"
            />
            <div
                class="text-danger fs-12"
                [input]="label"
                [fieldLabel]="'Label'"
                [appFieldError]="'maxlength'"
                [group]="createOrEditSubscriptionForm"
            ></div>
            <p class="text-muted fs-12">Optinal unique label to identify this webhook subscription</p>
        </div>
    </form>
    <div class="d-flex flex-column" *ngIf="secret">
        <label for="" class="form-label">Secret </label>
        <div class="d-flex flex-row">
            <input
                type="text"
                data-test-id="subscription-secret-created"
                [(ngModel)]="secret"
                class="form-control w-100"
                readonly
            />
            <app-copy-to-clipboard [text]="secret" [dataTestId]="'copyToClipboard-secret'" />
        </div>
        <p class="text-muted fs-12" role="alert">
            Make sure to copy your secret now. You wonâ€™t be able to see it again!
        </p>
    </div>

    <div class="d-flex flex-wrap justify-content-end my-3" *ngIf="!secret">
        <button class="btn btn-light me-4" (click)="cancel()" type="button">Cancel</button>
        <button
            class="btn btn-success"
            [disabled]="createOrEditSubscriptionForm.invalid"
            (click)="addWebhook()"
            type="button"
        >
            Add subscription
        </button>
    </div>
    <div class="d-flex flex-wrap justify-content-end my-3" *ngIf="secret">
        <button class="btn btn-success" (click)="navigateToListWebhooks()" type="button">Ok</button>
    </div>
</div>
