<div class="layout" *ngIf="history && datasetKind === 'ROOT'; else errorBlock">
    <div class="mt-4">
        <div class="border border-1 mt-4 px-2 py-4 rounded-3">
            <form [formGroup]="pollingSourceForm">
                <ng-container *ngIf="currentStep === steps.FETCH">
                    <app-base-step
                        [sectionStepRadioData]="FETCH_STEP_RADIO_DATA"
                        [sectionFormData]="FETCH_FORM_DATA"
                        [defaultKind]="FETCH_DEFAULT_KIND"
                        [sectionName]="steps.FETCH"
                        [eventYamlByHash]="eventYamlByHash"
                        eventHistory
                    ></app-base-step>
                    <app-stepper-navigation
                        [prevStep]="null"
                        [nextStep]="steps.PREPARE"
                        [validStep]="fetchForm.valid"
                        (changeStepEmitter)="changeStep($event)"
                    ></app-stepper-navigation>
                </ng-container>
                <ng-container *ngIf="currentStep === steps.PREPARE">
                    <app-prepare-step
                        [eventYamlByHash]="eventYamlByHash"
                        [sectionName]="steps.PREPARE"
                    ></app-prepare-step>
                    <app-stepper-navigation
                        [prevStep]="steps.FETCH"
                        [nextStep]="steps.READ"
                        [validStep]="fetchForm.valid"
                        (changeStepEmitter)="changeStep($event)"
                    ></app-stepper-navigation>
                </ng-container>

                <ng-container *ngIf="currentStep === steps.READ">
                    <app-base-step
                        [sectionStepRadioData]="READ_STEP_RADIO_DATA"
                        [sectionFormData]="READ_FORM_DATA"
                        [defaultKind]="READ_DEFAULT_KIND"
                        [sectionName]="steps.READ"
                        [eventYamlByHash]="eventYamlByHash"
                    ></app-base-step>
                    <app-stepper-navigation
                        [prevStep]="steps.PREPARE"
                        [nextStep]="steps.PREPROCESS"
                        [validStep]="readForm.valid"
                        (changeStepEmitter)="changeStep($event)"
                    ></app-stepper-navigation>
                </ng-container>
                <ng-container *ngIf="currentStep === steps.PREPROCESS">
                    <app-preprocess-step
                        [eventYamlByHash]="eventYamlByHash"
                        [preprocessValue]="preprocessStepValue"
                        [showPreprocessStep]="showPreprocessStep"
                        (showPreprocessStepEmitter)="
                            onShowPreprcessStep($event)
                        "
                    ></app-preprocess-step>
                    <app-stepper-navigation
                        [prevStep]="steps.READ"
                        [nextStep]="steps.MERGE"
                        [validStep]="fetchForm.valid"
                        (changeStepEmitter)="changeStep($event)"
                    ></app-stepper-navigation>
                </ng-container>
                <ng-container *ngIf="currentStep === steps.MERGE">
                    <app-base-step
                        [sectionStepRadioData]="MERGE_STEP_RADIO_DATA"
                        [sectionFormData]="MERGE_FORM_DATA"
                        [defaultKind]="MERGE_DEFAULT_KIND"
                        [sectionName]="steps.MERGE"
                        [eventYamlByHash]="eventYamlByHash"
                    >
                        <div
                            *ngIf="errorMessage"
                            class="alert alert-danger mt-2"
                            role="alert"
                        >
                            <p class="text-danger fs-6">
                                Error:<br />{{ errorMessage }}
                            </p>
                        </div></app-base-step
                    >
                    <app-stepper-navigation
                        [prevStep]="steps.PREPROCESS"
                        [nextStep]="null"
                        [validStep]="mergeForm.valid"
                        (changeStepEmitter)="changeStep($event)"
                        (saveEventEmitter)="onSubmit()"
                        (editYamlEmitter)="onEditYaml()"
                    ></app-stepper-navigation>
                </ng-container>
            </form>
        </div>
    </div>
    <!-- <pre>{{ pollingSourceForm.value | json }}</pre> -->
</div>
<ng-template #errorBlock>
    <app-page-not-found *ngIf="datasetKind"></app-page-not-found>
</ng-template>
