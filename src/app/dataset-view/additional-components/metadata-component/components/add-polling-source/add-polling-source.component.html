<div class="layout">
    <div class="mt-4">
        <ng-container *ngIf="currentStep === steps.FETCH">
            <div class="row">
                <div class="col mt-4">
                    <div class="form-check">
                        <input
                            class="form-check-input"
                            type="checkbox"
                            [(ngModel)]="isAddPrepareStep"
                            (change)="onCheckedPrepareStep($event)"
                            data-test-id="read-isAddPrepareStep"
                        />
                        <label class="form-check-label">
                            Add PREPARE step
                        </label>
                    </div>
                </div>
            </div>
            <div class="row mt-2">
                <div class="col">
                    <div class="form-check">
                        <input
                            class="form-check-input"
                            type="checkbox"
                            [(ngModel)]="isAddPreprocessStep"
                            (change)="onCheckedPreprocessStep($event)"
                            data-test-id="read-isAddPreprocessStep"
                        />
                        <label class="form-check-label">
                            Add PREPROCESS step
                        </label>
                    </div>
                </div>
            </div>
        </ng-container>
        <div class="border border-1 mt-4 px-2 py-4 rounded-3">
            <form [formGroup]="pollingSourceForm">
                <ng-container *ngIf="currentStep === steps.FETCH">
                    <app-base-step
                        [sectionStepRadioData]="fetchStepRadioData"
                        [sectionFormData]="fetchFormData"
                        [defaultKind]="fetchDefaultKind"
                        [groupName]="steps.FETCH"
                        [title]="'Fetch'"
                    ></app-base-step>
                    <app-stepper-navigation
                        [prevStep]="null"
                        [nextStep]="
                            isAddPrepareStep ? steps.PREPARE : steps.READ
                        "
                        [validStep]="fetchForm.valid"
                        (changeStepEmitter)="changeStep($event)"
                    ></app-stepper-navigation>
                </ng-container>
                <ng-container *ngIf="currentStep === steps.PREPARE">
                    <app-prepare-step></app-prepare-step>
                    <app-stepper-navigation
                        [prevStep]="steps.FETCH"
                        [nextStep]="steps.READ"
                        [validStep]="fetchForm.valid"
                        (changeStepEmitter)="changeStep($event)"
                    ></app-stepper-navigation>
                </ng-container>

                <ng-container *ngIf="currentStep === steps.READ">
                    <app-base-step
                        [sectionStepRadioData]="readStepRadioData"
                        [sectionFormData]="readFormData"
                        [defaultKind]="readDefaultKind"
                        [groupName]="steps.READ"
                        [title]="'Read'"
                    ></app-base-step>
                    <app-stepper-navigation
                        [prevStep]="
                            isAddPrepareStep ? steps.PREPARE : steps.FETCH
                        "
                        [nextStep]="
                            isAddPreprocessStep ? steps.PREPROCESS : steps.MERGE
                        "
                        [validStep]="readForm.valid"
                        (changeStepEmitter)="changeStep($event)"
                    ></app-stepper-navigation>
                </ng-container>
                <ng-container *ngIf="currentStep === steps.PREPROCESS">
                    <app-preprocess-step></app-preprocess-step>
                    <app-stepper-navigation
                        [prevStep]="steps.READ"
                        [nextStep]="steps.MERGE"
                        [validStep]="fetchForm.valid"
                        (changeStepEmitter)="changeStep($event)"
                    ></app-stepper-navigation>
                </ng-container>
                <ng-container *ngIf="currentStep === steps.MERGE">
                    <app-base-step
                        [sectionStepRadioData]="mergeStepRadioData"
                        [sectionFormData]="mergeFormData"
                        [defaultKind]="mergeDefaultKind"
                        [groupName]="steps.MERGE"
                        [title]="'Merge'"
                    >
                        <div
                            *ngIf="errorMessage"
                            class="alert alert-danger mt-2"
                            role="alert"
                        >
                            <p class="text-danger fs-6">
                                Error:<br />{{ errorMessage }}
                            </p>
                        </div></app-base-step
                    >
                    <app-stepper-navigation
                        [prevStep]="steps.READ"
                        [nextStep]="null"
                        [validStep]="mergeForm.valid"
                        (changeStepEmitter)="changeStep($event)"
                        (saveEventEmitter)="onSubmit()"
                        (editYamlEmitter)="onEditYaml()"
                    ></app-stepper-navigation>
                </ng-container>
            </form>
        </div>
    </div>

    <pre>{{ pollingSourceForm.value | json }}</pre>
</div>
