<div class="d-flex flex-column dynamic-table" [formGroup]="form">
    <label class="form-label">{{ label }}</label>

    <ng-container [formArrayName]="controlName">
        <table
            mat-table
            id="schema-field"
            [dataSource]="items.controls"
            class="mat-table cdk-table"
            cdkDropList
            (cdkDropListDropped)="drag($event)"
        >
            <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef width="40%">name</th>
                <td
                    mat-cell
                    *matCellDef="let element; let i = index"
                    [formGroup]="element"
                >
                    <input
                        type="text"
                        placeholder="Enter name"
                        formControlName="name"
                    />
                    <ng-container
                        *ngIf="
                            items.controls[i].get('name')?.hasError('unique')
                        "
                    >
                        <small class="text-danger ps-2">
                            Name is not unique</small
                        >
                    </ng-container>
                    <ng-container
                        *ngIf="
                            items.controls[i].get('name')?.hasError('noneOf')
                        "
                    >
                        <small class="text-danger ps-2">
                            Type cannot be name</small
                        >
                    </ng-container>
                    <ng-container
                        *ngIf="
                            items.controls[i]
                                .get('name')
                                ?.hasError('required') &&
                            items.controls[i].get('name')?.invalid &&
                            (items.controls[i].get('name')?.dirty ||
                                items.controls[i].get('name')?.touched)
                        "
                    >
                        <small class="text-danger ps-2">
                            Name is required</small
                        >
                    </ng-container>
                </td>
            </ng-container>

            <ng-container matColumnDef="type">
                <th mat-header-cell *matHeaderCellDef width="40%">type</th>
                <td
                    mat-cell
                    *matCellDef="let element; let i = index"
                    [formGroup]="element"
                >
                    <input
                        type="text"
                        class="w-100"
                        formControlName="type"
                        placeholder="-- Select type --"
                        [ngbTypeahead]="search"
                        (focus)="focus$.next(items.controls[i].value)"
                        (click)="click$.next(items.controls[i].value)"
                    />
                </td>
            </ng-container>

            <ng-container matColumnDef="actions">
                <th mat-header-cell class="text-center" *matHeaderCellDef>
                    actions
                </th>
                <td mat-cell *matCellDef="let element; let i = index">
                    <div class="custom-cell">
                        <mat-icon
                            class="icon fs-5"
                            title="delete"
                            (click)="deleteRow(i)"
                            >delete</mat-icon
                        >
                    </div>
                </td>
            </ng-container>
            <tr
                mat-header-row
                class="table-header-background"
                *matHeaderRowDef="displayedColumns"
            ></tr>
            <tr
                mat-row
                *matRowDef="let row; columns: displayedColumns"
                cdkDrag
                cdkDragLockAxis="y"
            ></tr>
        </table>
    </ng-container>

    <div class="mt-2">
        <button (click)="addRow()" type="button" class="btn-sm btn add-button">
            <span class="fw-bold">+</span> Add row
        </button>
    </div>
</div>
