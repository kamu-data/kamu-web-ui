<div class="mb-3">
    <mat-icon class="fs-4 align-middle">input</mat-icon>
    <label for="inputDatasets" class="form-label ps-1"> Input datasets</label>
    <div class="d-flex flex-row align-items-center">
        <input
            type="text"
            class="form-control w-425"
            #searchDatasets
            placeholder="Look up a dataset..."
            [(ngModel)]="searchDataset"
            [ngbTypeahead]="search"
            [resultTemplate]="rt"
            [inputFormatter]="formatter"
            (selectItem)="onSelectItem($event)"
        />
        <button
            (click)="clearSearch()"
            mat-stroked-button
            class="ms-4 button-custom bg-secondary text-white"
        >
            Clear
        </button>
    </div>
</div>
<ng-template #rt let-r="result" let-t="term">
    <div
        class="d-flex flex-row justify-content-between"
        [style.width.px]="searchDatasets.clientWidth - 28"
    >
        <div>
            <i class="bi bi-journal-album mr-2"></i>
            <ngb-highlight [result]="r.dataset.name" [term]="t"></ngb-highlight>
        </div>
        <div
            class="border rounded-1 flex-shrink-0 color-bg-tertiary px-1 f6 button-add color-text-tertiary ml-1"
        >
            Add
            <span class="d-inline-block ml-1 v-align-middle"
                ><i class="bi bi-arrow-return-left"></i
            ></span>
        </div>
    </div>
</ng-template>
<div class="mt-4">
    <mat-tree
        [dataSource]="dataSource"
        [treeControl]="treeControl"
        class="tree"
    >
        <mat-tree-node *matTreeNodeDef="let node" matTreeNodeToggle>
            {{ node.name }}&nbsp;&nbsp; (
            <span class="fw-bold">{{ node.type }}</span> )
        </mat-tree-node>
        <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild">
            <div class="mat-tree-node">
                <button
                    mat-icon-button
                    matTreeNodeToggle
                    [attr.aria-label]="'Toggle ' + node.name"
                >
                    <mat-icon class="mat-icon-rtl-mirror">
                        {{
                            treeControl.isExpanded(node)
                                ? "expand_more"
                                : "chevron_right"
                        }}
                    </mat-icon>
                </button>
                <span class="node-name"> {{ node.name }}</span>
                <button
                    class="no-button"
                    (click)="deleteInputDataset(node.name)"
                    title="Delete input dataset"
                >
                    <mat-icon class="fs-4 hover">delete</mat-icon>
                </button>
            </div>

            <div
                [class.example-tree-invisible]="!treeControl.isExpanded(node)"
                role="group"
            >
                <ng-container matTreeNodeOutlet></ng-container>
            </div>
        </mat-nested-tree-node>
    </mat-tree>
</div>
