<div class="search-result-container__content" id="searchResultContainerContent">
    <div id="metadata-block">
        <div id="pagination-block" *ngIf="currentState">
            <app-custom-pagination
                [hash]="latestBlockhash"
                [date]="latestBlockSystemTime"
                [pageIndex]="currentPage"
                [limit]="5"
                [total]="totalPages"
                (pageChange)="onPageChange($event)"
            ></app-custom-pagination>
        </div>

        <ng-container *ngIf="currentState">
            <div class="d-flex flex-column gap-4 mt-4">
                <div
                    class="position-relative border border-1 p-2 rounded-3"
                    *ngIf="currentState.schema"
                >
                    <span
                        class="position-absolute text-muted group-box-label text-uppercase"
                        >Schema</span
                    >
                    <div class="mx-4">
                        <app-block-row-data
                            [tooltip]="
                                'A DDL-formatted schema. Schema can be used to coerce values into more appropriate data types.'
                            "
                            [label]="'Schema:'"
                        >
                            <app-dynamic-table
                                [hasTableHeader]="true"
                                [schemaFields]="currentState.schema.fields"
                                [idTable]="'schema-block-table'"
                            ></app-dynamic-table>
                        </app-block-row-data>
                    </div>
                </div>
                <div
                    *ngIf="currentState.metadata.metadata.currentLicense"
                    class="position-relative border border-1 p-2 rounded-3"
                >
                    <span
                        class="position-absolute text-muted group-box-label text-uppercase"
                        >License</span
                    >
                    <div class="mx-4">
                        <app-block-row-data
                            [tooltip]="'Unique identifier of the license.'"
                            [label]="'ID:'"
                        >
                            <span>{{
                                currentState.metadata.metadata.currentLicense
                                    .shortName
                            }}</span>
                        </app-block-row-data>
                    </div>

                    <div class="mx-4">
                        <app-block-row-data
                            [tooltip]="'Full name of the license.'"
                            [label]="'Name:'"
                        >
                            <span>
                                {{
                                    currentState.metadata.metadata
                                        .currentLicense.name
                                }}</span
                            >
                        </app-block-row-data>
                    </div>

                    <div
                        class="mx-4"
                        *ngIf="
                            currentState.metadata.metadata.currentLicense.spdxId
                        "
                    >
                        <app-block-row-data
                            [tooltip]="
                                'License identifier from the SPDX License List.'
                            "
                            [label]="'SPDX ID:'"
                        >
                            <span>
                                {{
                                    currentState.metadata.metadata
                                        .currentLicense.spdxId
                                }}</span
                            >
                        </app-block-row-data>
                    </div>

                    <div class="mx-4">
                        <app-block-row-data
                            [tooltip]="'Link to the official website.'"
                            [label]="'Website:'"
                        >
                            <app-link-property
                                [data]="
                                    currentState.metadata.metadata
                                        .currentLicense.websiteUrl
                                "
                            ></app-link-property>
                        </app-block-row-data>
                    </div>
                </div>

                <ng-container
                    *ngIf="currentState.metadata.metadata.currentSource"
                >
                    <div
                        class="position-relative border border-1 p-2 rounded-3"
                    >
                        <span
                            class="position-absolute text-muted group-box-label text-uppercase"
                            >Fetch</span
                        >
                        <div
                            class="mx-4"
                            *ngIf="
                                currentState.metadata.metadata.currentSource
                                    .fetch.__typename === 'FetchStepUrl'
                            "
                        >
                            <app-block-row-data
                                [tooltip]="'URL of the data source.'"
                                [label]="'Url:'"
                            >
                                <app-link-property
                                    [data]="
                                        currentState.metadata.metadata
                                            .currentSource.fetch.url
                                    "
                                ></app-link-property>
                            </app-block-row-data>
                        </div>

                        <div
                            class="mx-4"
                            *ngIf="
                                currentState.metadata.metadata.currentSource
                                    .fetch.__typename === 'FetchStepContainer'
                            "
                        >
                            <app-block-row-data
                                [tooltip]="
                                    'Image name and and an optional tag.'
                                "
                                [label]="'Image:'"
                            >
                                <span>{{
                                    currentState.metadata.metadata.currentSource
                                        .fetch.image
                                }}</span>
                            </app-block-row-data>
                        </div>

                        <div
                            class="mx-4"
                            *ngIf="
                                currentState.metadata.metadata.currentSource
                                    .fetch.__typename === 'FetchStepFilesGlob'
                            "
                        >
                            <app-block-row-data
                                [tooltip]="'Path with a glob pattern.'"
                                [label]="'Path:'"
                            >
                                <span>{{
                                    currentState.metadata.metadata.currentSource
                                        .fetch.path
                                }}</span>
                            </app-block-row-data>
                        </div>
                    </div>

                    <div
                        class="position-relative border border-1 p-2 rounded-3"
                    >
                        <span
                            class="position-absolute text-muted group-box-label text-uppercase"
                            >Read</span
                        >
                        <div
                            class="mx-4"
                            *ngIf="
                                currentState.metadata.metadata.currentSource
                                    .read.__typename
                            "
                        >
                            <app-block-row-data
                                [tooltip]="
                                    'Determines where data is sourced from.'
                                "
                                [label]="'Type:'"
                            >
                                <span>{{
                                    readSectionMapperType[
                                        currentState.metadata.metadata
                                            .currentSource.read.__typename
                                    ]
                                }}</span>
                            </app-block-row-data>
                        </div>

                        <div
                            class="mx-4"
                            *ngIf="
                                (currentState.metadata.metadata.currentSource
                                    .read.__typename === 'ReadStepCsv' ||
                                    currentState.metadata.metadata.currentSource
                                        .read.__typename ===
                                        'ReadStepJsonLines') &&
                                currentState.metadata.metadata.currentSource
                                    .read.schema
                            "
                        >
                            <app-block-row-data
                                [tooltip]="
                                    'A DDL-formatted schema. Schema can be used to coerce values into more appropriate data types.'
                                "
                                [label]="'Schema:'"
                            >
                                <app-schema-property
                                    [data]="
                                        currentState.metadata.metadata
                                            .currentSource.read.schema
                                    "
                                ></app-schema-property>
                            </app-block-row-data>
                        </div>
                    </div>

                    <div
                        class="position-relative border border-1 p-2 rounded-3"
                    >
                        <span
                            class="position-absolute text-muted group-box-label text-uppercase"
                            >Merge</span
                        >
                        <div
                            class="mx-4"
                            *ngIf="
                                currentState.metadata.metadata.currentSource
                                    .merge.__typename === 'MergeStrategyLedger'
                            "
                        >
                            <app-block-row-data
                                [tooltip]="
                                    'Merge strategy determines how newly ingested data should be combined with the data that already exists in the dataset.'
                                "
                                [label]="'Strategy:'"
                            >
                                <app-merge-strategy-property
                                    [data]="
                                        currentState.metadata.metadata
                                            .currentSource.merge.__typename
                                    "
                                ></app-merge-strategy-property>
                            </app-block-row-data>
                        </div>

                        <div
                            class="mx-4"
                            *ngIf="
                                currentState.metadata.metadata.currentSource
                                    .merge.__typename === 'MergeStrategyLedger'
                            "
                        >
                            <app-block-row-data
                                [tooltip]="
                                    'Names of the columns that uniquely identify the record throughout its lifetime.'
                                "
                                [label]="'Primary key:'"
                            >
                                <app-cards-property
                                    [data]="
                                        currentState.metadata.metadata
                                            .currentSource.merge.primaryKey
                                    "
                                ></app-cards-property>
                            </app-block-row-data>
                        </div>
                    </div>

                    <div
                        *ngIf="
                            currentState.metadata.metadata.currentSource
                                .preprocess
                        "
                        class="position-relative border border-1 p-2 rounded-3"
                    >
                        <span
                            class="position-absolute text-muted group-box-label text-uppercase"
                            >Preprocess</span
                        >
                        <div class="mx-4">
                            <app-block-row-data
                                [tooltip]="
                                    'Identifier of the engine used for this transformation.'
                                "
                                [label]="'Engine:'"
                            >
                                <app-engine-property
                                    [data]="
                                        currentState.metadata.metadata
                                            .currentSource.preprocess.engine
                                    "
                                ></app-engine-property>
                            </app-block-row-data>
                        </div>

                        <div class="mx-4">
                            <app-block-row-data
                                [tooltip]="
                                    'Queries use for specifying multi-step SQL transformations.'
                                "
                                [label]="'Queries:'"
                            >
                            </app-block-row-data>
                            <div class="row my-4">
                                <app-sql-query-viewer
                                    [data]="
                                        currentState.metadata.metadata
                                            .currentSource.preprocess.queries
                                    "
                                ></app-sql-query-viewer>
                            </div>
                        </div>
                    </div>
                </ng-container>

                <div
                    class="position-relative border border-1 p-2 rounded-3"
                    *ngIf="currentState.metadata.metadata.currentWatermark"
                >
                    <span
                        class="position-absolute text-muted group-box-label text-uppercase"
                        >Watermark</span
                    >
                    <div class="mx-4">
                        <app-block-row-data
                            [tooltip]="
                                'Last watermark of the output data stream.'
                            "
                            [label]="'Watermark:'"
                        >
                            <app-display-time
                                [data]="
                                    currentState.metadata.metadata
                                        .currentWatermark
                                "
                            ></app-display-time>
                        </app-block-row-data>
                    </div>
                </div>

                <ng-container
                    *ngIf="
                        currentState &&
                        currentState.metadata.metadata.currentTransform
                    "
                >
                    <div
                        class="position-relative border border-1 p-2 rounded-3"
                        *ngFor="
                            let input of currentState.metadata.metadata
                                .currentTransform.inputs;
                            let i = index
                        "
                    >
                        <span
                            class="position-absolute text-muted group-box-label text-uppercase"
                            >Inputs {{ i + 1 }}</span
                        >
                        <div class="mx-4">
                            <app-block-row-data
                                [tooltip]="'Unique dataset identifier.'"
                                [label]="'Id:'"
                            >
                                <span>{{ input.dataset.id }}</span>
                            </app-block-row-data>
                        </div>
                        <div class="mx-4">
                            <app-block-row-data
                                [tooltip]="'Type of the dataset.'"
                                [label]="'Dataset type:'"
                            >
                                <span>{{
                                    kindToCamelCase(input.dataset.kind)
                                }}</span>
                            </app-block-row-data>
                        </div>
                        <div class="mx-4">
                            <app-block-row-data
                                [tooltip]="'Type of the dataset.'"
                                [label]="'Name:'"
                            >
                                <app-dataset-name-property
                                    [data]="{
                                        datasetName: input.dataset.name,
                                        owner: input.dataset.owner.name
                                    }"
                                ></app-dataset-name-property>
                            </app-block-row-data>
                        </div>
                        <div class="mx-4">
                            <app-block-row-data
                                [tooltip]="'Owner of the dataset.'"
                                [label]="'Owner:'"
                            >
                                <app-owner-property
                                    [data]="{
                                        id: input.dataset.owner.id,
                                        name: input.dataset.owner.name
                                    }"
                                ></app-owner-property>
                            </app-block-row-data>
                        </div>
                        <div class="mx-4">
                            <app-block-row-data
                                [tooltip]="'Query alias of the dataset.'"
                                [label]="'Query alias:'"
                            >
                                <span>{{ input.name }}</span>
                            </app-block-row-data>
                        </div>
                    </div>
                    <div
                        class="position-relative border border-1 p-2 rounded-3"
                    >
                        <span
                            class="position-absolute text-muted group-box-label text-uppercase"
                            >Transform</span
                        >
                        <div class="mx-4">
                            <app-block-row-data
                                [tooltip]="
                                    'Identifier of the engine used for this transformation.'
                                "
                                [label]="'Engine:'"
                            >
                                <app-engine-property
                                    [data]="
                                        currentState.metadata.metadata
                                            .currentTransform.transform.engine
                                    "
                                ></app-engine-property>
                            </app-block-row-data>
                        </div>

                        <div class="mx-4">
                            <app-block-row-data
                                [tooltip]="
                                    'Queries use for specifying multi-step SQL transformations.'
                                "
                                [label]="'Queries:'"
                            >
                            </app-block-row-data>
                            <div class="row my-4">
                                <app-sql-query-viewer
                                    [data]="
                                        currentState.metadata.metadata
                                            .currentTransform.transform.queries
                                    "
                                ></app-sql-query-viewer>
                            </div>
                        </div>
                    </div>
                </ng-container>
            </div>
        </ng-container>
        <ng-container
            *ngIf="
                !currentState?.metadata?.metadata?.currentSource &&
                !currentState?.metadata?.metadata?.currentTransform
            "
        >
            <h3 class="box-title text-center">There is no metadata.</h3>
        </ng-container>
    </div>
</div>
