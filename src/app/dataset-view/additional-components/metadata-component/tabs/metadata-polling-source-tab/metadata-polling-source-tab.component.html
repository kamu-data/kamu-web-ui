<div class="d-flex justify-content-start mb-4" *ngIf="canEditSetPollingSource">
    <button
        appFeatureFlag="dataset.panel.metadata.editPollingSource"
        class="border-1 bg-light border edit-polling-source-btn rounded-2 me-3 btn btn-sm justify-content-between align-items-center"
        data-test-id="edit-polling-source"
        (click)="navigateToEditPollingSource()"
    >
        <mat-icon class="mat-icon-svg-size me-2 text-muted" svgIcon="pencil" />
        <span class="fs-12 me-2">Edit polling source</span>
    </button>
    <button
        appFeatureFlag="dataset.panel.metadata.deletePollingSource"
        class="border-1 bg-light border delete-polling-source-btn rounded-2 px-2 btn btn-sm justify-content-between align-items-center"
        data-test-id="'edit-source-link'"
        (click)="onDeletePollingSource()"
    >
        <mat-icon class="text-muted fs-4 d-block">delete</mat-icon>
        <span class="fs-12 me-2 d-block"> Delete polling source</span>
    </button>
</div>

<ng-container *ngIf="pollingSource">
    <div class="position-relative border border-1 p-2 rounded-3">
        <span class="position-absolute text-muted group-box-label text-uppercase">Fetch</span>
        <div class="mx-4" *ngIf="pollingSource.fetch.__typename === 'FetchStepUrl'">
            <app-block-row-data [tooltip]="'URL of the data source.'" [label]="'Url:'">
                <app-link-property data-test-id="fetch-step-url" [data]="pollingSource.fetch.url" />
            </app-block-row-data>
        </div>

        <div class="mx-4" *ngIf="pollingSource.fetch.__typename === 'FetchStepContainer'">
            <app-block-row-data [tooltip]="'Image name and and an optional tag.'" [label]="'Image:'">
                <span>{{ pollingSource.fetch.image }}</span>
            </app-block-row-data>
        </div>

        <div class="mx-4" *ngIf="pollingSource.fetch.__typename === 'FetchStepFilesGlob'">
            <app-block-row-data [tooltip]="'Path with a glob pattern.'" [label]="'Path:'">
                <span>{{ pollingSource.fetch.path }}</span>
            </app-block-row-data>
        </div>

        <div class="mx-4" *ngIf="pollingSource.fetch.__typename === 'FetchStepMqtt'">
            <app-block-row-data [tooltip]="'Hostname of the MQTT broker.'" [label]="'Hostname:'">
                <span>{{ pollingSource.fetch.host }}</span>
            </app-block-row-data>
            <app-block-row-data [tooltip]="'Port of the MQTT broker.'" [label]="'Port:'">
                <span>{{ pollingSource.fetch.port }}</span>
            </app-block-row-data>
        </div>

        <div class="mx-4" *ngIf="pollingSource.fetch.__typename === 'FetchStepEthereumLogs'">
            <app-block-row-data
                [tooltip]="'Connects to an Ethereum node to stream transaction logs.'"
                [label]="'Type:'"
            >
                <span>Ethereum Logs</span>
            </app-block-row-data>
            <app-block-row-data
                *ngIf="pollingSource.fetch.chainId"
                [tooltip]="'Identifier of the chain to scan logs from.'"
                [label]="'Chain ID:'"
            >
                <span>{{ pollingSource.fetch.chainId }}</span>
            </app-block-row-data>
            <app-block-row-data
                *ngIf="pollingSource.fetch.nodeUrl"
                [tooltip]="'Url of the node.'"
                [label]="'Node url:'"
            >
                <a class="simple-link" [href]="pollingSource.fetch.nodeUrl">{{ pollingSource.fetch.nodeUrl }}</a>
            </app-block-row-data>
            <app-block-row-data
                *ngIf="pollingSource.fetch.filter"
                [tooltip]="
                    'An SQL WHERE clause that can be used to pre-filter the logs before fetching them from the ETH node.'
                "
                [label]="'Filter:'"
            >
                <app-yaml-event-viewer [data]="pollingSource.fetch.filter" />
            </app-block-row-data>
            <app-block-row-data
                *ngIf="pollingSource.fetch.signature"
                [tooltip]="
                    'Solidity log event signature to use for decoding. Using this field adds event to the output containing decoded log as JSON.'
                "
                [label]="'Signature:'"
            >
                <app-yaml-event-viewer [data]="pollingSource.fetch.signature" />
            </app-block-row-data>
        </div>
    </div>
    <app-source-event-common-data [sourceEvent]="pollingSource" />
</ng-container>
