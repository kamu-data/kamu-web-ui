<div class="d-flex justify-content-start mb-4" *ngIf="canEditSetTransform">
    <button
        appFeatureFlag="dataset.panel.metadata.editTransform"
        class="border-1 bg-light border rounded-2 me-3 btn btn-sm justify-content-between align-items-center"
        data-test-id="'edit-transformation-link'"
        (click)="navigateToEditSetTransform()"
    >
        <mat-icon class="mat-icon-svg-size me-2 text-muted" svgIcon="pencil" />
        <span class="fs-12 me-2">Edit transformation</span>
    </button>
</div>

<ng-container *ngIf="transformation">
    <div
        class="position-relative border border-1 p-2 rounded-3 mb-4"
        *ngFor="let input of transformation.inputs; let i = index"
    >
        <ng-container *ngIf="input.inputDataset.__typename === 'TransformInputDatasetAccessible'">
            <span class="position-absolute text-muted group-box-label text-uppercase">Input {{ i + 1 }}</span>
            <div class="mx-4">
                <app-block-row-data [tooltip]="'Unique dataset identifier.'" [label]="'Id:'">
                    <span class="font-monospace">{{ input.inputDataset.dataset.id }}</span>
                </app-block-row-data>
            </div>
            <div class="mx-4">
                <app-block-row-data [tooltip]="'Type of the dataset.'" [label]="'Dataset type:'">
                    <span>{{ input.inputDataset.dataset.kind | titlecase }}</span>
                </app-block-row-data>
            </div>
            <div class="mx-4">
                <app-block-row-data [tooltip]="'Type of the dataset.'" [label]="'Name:'">
                    <app-dataset-name-property
                        [data]="{
                            datasetName: input.inputDataset.dataset.name,
                            ownerAccountName: input.inputDataset.dataset.owner.accountName,
                        }"
                    />
                </app-block-row-data>
            </div>
            <div class="mx-4">
                <app-block-row-data [tooltip]="'Owner of the dataset.'" [label]="'Owner:'">
                    <app-owner-property
                        [data]="{
                            id: input.inputDataset.dataset.owner.id,
                            accountName: input.inputDataset.dataset.owner.accountName,
                            accountProvider: input.inputDataset.dataset.owner.accountProvider,
                        }"
                    />
                </app-block-row-data>
            </div>
            <div class="mx-4">
                <app-block-row-data [tooltip]="'Query alias of the dataset.'" [label]="'Query alias:'">
                    <span>{{ input.alias }}</span>
                </app-block-row-data>
            </div>
        </ng-container>
        <ng-container *ngIf="input.inputDataset.__typename === 'TransformInputDatasetNotAccessible'">
            <span class="position-absolute text-muted group-box-label text-uppercase">Inputs {{ i + 1 }}</span>
            <div class="mx-4">
                <app-block-row-data [tooltip]="'Unique dataset identifier. Dataset is private'" [label]="'Id:'">
                    <span>{{ input.inputDataset.datasetRef }}</span>
                </app-block-row-data>
            </div>
        </ng-container>
    </div>
    <div class="position-relative border border-1 p-2 rounded-3">
        <span class="position-absolute text-muted group-box-label text-uppercase">Transform</span>
        <div class="mx-4">
            <app-block-row-data
                [tooltip]="'Identifier of the engine used for this transformation.'"
                [label]="'Engine:'"
            >
                <app-engine-property [data]="transformation.transform.engine" />
            </app-block-row-data>
        </div>

        <div class="mx-4">
            <app-block-row-data
                [tooltip]="'Queries use for specifying multi-step SQL transformations.'"
                [label]="'Queries:'"
            >
            </app-block-row-data>
            <div class="row my-4">
                <app-sql-query-viewer [data]="transformation.transform.queries" />
            </div>
        </div>
    </div>
</ng-container>
