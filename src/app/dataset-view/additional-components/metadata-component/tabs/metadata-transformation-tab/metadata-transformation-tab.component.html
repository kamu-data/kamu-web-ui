<div class="d-flex justify-content-start mb-4" *ngIf="canEditSetTransform">
    <button
        appFeatureFlag="dataset.panel.metadata.editTransform"
        class="border-1 bg-light border rounded-2 me-3 btn btn-sm justify-content-between align-items-center"
        data-test-id="'edit-transformation-link'"
        (click)="navigateToEditSetTransform()"
    >
        <mat-icon class="mat-icon-svg-size me-2 text-muted" svgIcon="pencil" />
        <span class="fs-12 me-2">Edit transformation</span>
    </button>
</div>

<ng-container *ngIf="transformation">
    <div
        class="position-relative border border-1 p-2 rounded-3 mb-4"
        *ngFor="let input of transformation.inputs; let i = index"
    >
        <ng-container *ngIf="input.inputDataset.__typename === 'TransformInputDatasetAccessible'">
            <span class="position-absolute text-muted group-box-label text-uppercase">Input {{ i + 1 }}</span>
            <div class="mx-4">
                <app-block-row-data [tooltip]="'Unique dataset identifier.'" [label]="'Id:'">
                    <span class="font-monospace">{{ input.inputDataset.dataset.id }}</span>
                </app-block-row-data>
            </div>
            <div class="mx-4" *ngIf="input.inputDataset.__typename === 'TransformInputDatasetAccessible'">
                <app-block-row-data [tooltip]="'Summary of the dataset.'" [label]="'Dataset:'">
                    <div class="d-flex flex-row">
                        <div class="me-2 mb-1">
                            <a [routerLink]="['/', input.inputDataset.dataset.owner.accountName]">
                                <img
                                    [src]="input.inputDataset.dataset.owner.avatarUrl || DEFAULT_AVATAR_URL"
                                    width="20"
                                    height="20"
                                    [alt]="'@' + input.inputDataset.dataset.owner.accountName"
                                    [attr.data-test-id]="'user-avatar'"
                                />
                            </a>
                        </div>
                        <a
                            [routerLink]="[
                                '/',
                                input.inputDataset.dataset.owner.accountName,
                                input.inputDataset.dataset.name,
                            ]"
                            attr.data-test-id="dataset-name-button-{{ i }}"
                            class="dataset-list-container-title mb-1 pl-0"
                        >
                            {{ input.inputDataset.dataset.owner.accountName }}/{{ input.inputDataset.dataset.name }}
                        </a>
                        <app-dataset-visibility
                            class="ms-2"
                            [datasetVisibility]="input.inputDataset.dataset.visibility"
                        />
                        <app-dataset-kind [kind]="input.inputDataset.dataset.kind" />
                    </div>
                </app-block-row-data>
            </div>

            <div class="mx-4">
                <app-block-row-data [tooltip]="'Query alias of the dataset.'" [label]="'Query alias:'">
                    <span>{{ input.alias }}</span>
                </app-block-row-data>
            </div>
        </ng-container>
        <ng-container *ngIf="input.inputDataset.__typename === 'TransformInputDatasetNotAccessible'">
            <span class="position-absolute text-muted group-box-label text-uppercase">Inputs {{ i + 1 }}</span>
            <div class="mx-4">
                <app-block-row-data [tooltip]="'Unique dataset identifier. Dataset is private'" [label]="'Id:'">
                    <span>{{ input.inputDataset.datasetRef }}</span>
                </app-block-row-data>
            </div>
        </ng-container>
    </div>
    <div class="position-relative border border-1 p-2 rounded-3">
        <span class="position-absolute text-muted group-box-label text-uppercase">Transform</span>
        <div class="mx-4">
            <app-block-row-data
                [tooltip]="'Identifier of the engine used for this transformation.'"
                [label]="'Engine:'"
            >
                <app-engine-property [data]="transformation.transform.engine" />
            </app-block-row-data>
        </div>

        <div class="mx-4">
            <app-block-row-data
                [tooltip]="'Queries use for specifying multi-step SQL transformations.'"
                [label]="'Queries:'"
            >
            </app-block-row-data>
            <div class="row my-4">
                <app-sql-query-viewer [data]="transformation.transform.queries" />
            </div>
        </div>
    </div>
</ng-container>
