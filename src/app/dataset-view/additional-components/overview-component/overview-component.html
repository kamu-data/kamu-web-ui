<div class="dataset-result-container">
    <div
        class="search-result-container__content"
        id="searchResultContainerContent"
        *ngIf="datasetBasics && currentState"
    >
        <div>
            <div
                class="d-flex flex-column flex-justify-between pb-3 mb-3 position-relative"
            >
                <ng-container
                    *ngIf="currentState.overview.metadata.currentInfo?.description;else  noCurrentInfo"
                >
                    <div
                        class="d-flex justify-content-between align-items-center"
                    >
                        <h2 class="box-title align-items-center pb-3">
                            Description
                        </h2>
                        <button
                            class="btn-sm btn custom-edit"
                            aria-label="Edit dataset details"
                            data-test-id="edit-dataset-details"
                            title="Edit dataset details"
                            (click)="openInformationModal(content)"
                        >
                            <svg-icon name="pencil"></svg-icon>
                        </button>
                    </div>
                    <p>
                        {{
                        currentState.overview.metadata.currentInfo.description
                        }}
                    </p>
                    <div class="app-mat-chip">
                        <mat-chip-list aria-label="Tags selection">
                            <div
                                *ngFor="let keyword of currentState.overview.metadata.currentInfo?.keywords"
                            >
                                <mat-chip
                                    (click)="selectTopic(datasetBasics.kind)"
                                    >{{ keyword }}</mat-chip
                                >
                            </div>
                        </mat-chip-list>
                    </div>
                </ng-container>
                <ng-template #noCurrentInfo>
                    <p>
                        You can add
                        <a
                            class="text-decoration-none"
                            (click)="openInformationModal(content)"
                            >information</a
                        >
                        about dataset.
                    </p>
                </ng-template>
                <ng-template #content let-modal>
                    <div ngbAutoFocus class="d-flex p-4">
                        <div class="flex-grow-1 ms-2 text-center">
                            <span class="fs-5 fw-bold">
                                {{isDetailsExist?'Edit':'Add'}} dataset
                                details</span
                            >
                        </div>
                        <div>
                            <button
                                type="button"
                                class="btn-close"
                                aria-label="Close"
                                (click)="modal.dismiss()"
                            ></button>
                        </div>
                    </div>
                    <div class="px-4">
                        <mat-divider></mat-divider>
                    </div>

                    <div class="body p-4">
                        <div>
                            <label for="dataset-descriptio" class="form-label"
                                >Description</label
                            >
                            <textarea
                                class="form-control"
                                id="dataset-description"
                                placeholder="Please enter description..."
                                rows="5"
                                [(ngModel)]="description"
                            >
                            </textarea>
                        </div>
                        <div class="mt-5 mb-3">
                            <label for="keywords" class="form-label mb-3"
                                >Keywords</label
                            >

                            <mat-chip-list
                                class="w-100"
                                #chipList
                                aria-label="Keyword selection"
                            >
                                <mat-chip
                                    class="custom-mat-chip"
                                    *ngFor="let keyword of keywords"
                                >
                                    {{keyword}}
                                    <button
                                        matChipRemove
                                        (click)="removeKeyword(keyword)"
                                    >
                                        <mat-icon>cancel</mat-icon>
                                    </button>
                                </mat-chip>
                            </mat-chip-list>
                            <div class="mt-3">
                                <input
                                    class="form-control w-100"
                                    [matChipInputFor]="chipList"
                                    (matChipInputTokenEnd)="addKeywordFromInput($event)"
                                    placeholder="Please enter keyword..."
                                />
                            </div>
                        </div>
                    </div>

                    <div class="p-4 d-flex justify-content-end">
                        <button
                            type="button"
                            class="btn btn-success"
                            (click)="modal.close()"
                        >
                            Save
                        </button>
                    </div>
                </ng-template>
            </div>
            <app-overview-history-summary-header
                [metadataBlockFragment]="metadataFragmentBlock"
                [numBlocksTotal]="currentState.overview.metadata.chain.blocks.totalCount || 0"
                [datasetName]="datasetBasics.name"
            ></app-overview-history-summary-header>
            <app-dynamic-table
                *ngIf="currentState && currentState.schema"
                [hasTableHeader]="true"
                [schemaFields]="currentState.schema.fields"
                [dataRows]="currentState ? currentState.data : []"
            ></app-dynamic-table>
            <div
                id="file-readme-dataset-template-md"
                class="file my-4"
                *ngIf="currentState.overview.metadata.currentReadme"
            >
                <div class="file-header d-flex align-items-center">
                    <div
                        class="file-info pr-4 d-flex flex-order-1 flex-auto align-items-center"
                    >
                        <span class="mr-2">
                            <svg-icon name="code-square"></svg-icon>
                        </span>
                        <h2 class="box-title align-items-center m-0">
                            <a
                                href="#readme"
                                data-view-component="true"
                                class="link--primary"
                                >README.md</a
                            >
                        </h2>
                    </div>
                    <button
                        class="starred rounded-2 btn-sm btn btnGroup-item d-flex justify-content-center align-items-center"
                        aria-label="Edit this file"
                        data-test-id="toggleReadme"
                        data-hotkey="e"
                        data-disable-with=""
                        (click)="toggleReadmeView()"
                    >
                        <svg-icon name="pencil"></svg-icon>
                    </button>
                </div>
                <div class="file-content">
                    <ng-template [ngIf]="isMarkdownEditView">
                        <textarea
                            class="variable-textarea"
                            [(ngModel)]="currentState.overview.metadata.currentReadme"
                        ></textarea>
                    </ng-template>
                    <ng-template [ngIf]="!isMarkdownEditView">
                        <markdown
                            class="variable-binding"
                            [data]="currentState.overview.metadata.currentReadme"
                        ></markdown>
                    </ng-template>
                </div>
            </div>
        </div>
    </div>
    <div class="card">
        <nav class="flex-row mat-typography">
            <div class="card--row card--title">
                <h2>Details</h2>
            </div>
            <div class="card--row dataset-info">
                <ng-template [ngIf]="datasetBasics && currentState">
                    <div class="dataset-info--block">
                        <div class="dataset-info--sub-block">
                            <h2 class="dataset-info--subtitle">Kind:</h2>
                        </div>
                        <div class="dataset-info--sub-block">
                            <p class="dataset-info--text">
                                {{ datasetKind(datasetBasics.kind) }}
                            </p>
                        </div>
                    </div>
                    <div class="dataset-info--block">
                        <div class="dataset-info--sub-block">
                            <h2 class="dataset-info--subtitle">Visibility:</h2>
                        </div>
                        <div class="dataset-info--sub-block">
                            <p class="dataset-info--text">Public</p>
                        </div>
                    </div>
                    <div
                        class="dataset-info--block"
                        *ngIf="currentState.overview.metadata.currentLicense"
                    >
                        <div class="dataset-info--sub-block">
                            <h2 class="dataset-info--subtitle">License:</h2>
                        </div>
                        <div class="dataset-info--sub-block">
                            <a
                                class="link--primary"
                                (click)="showWebsite(currentState.overview.metadata.currentLicense.websiteUrl)"
                            >
                                <p
                                    class="dataset-info--text"
                                    placement="bottom"
                                    [ngbTooltip]="currentState.overview.metadata.currentLicense.name"
                                >
                                    {{
                                    currentState.overview.metadata.currentLicense.shortName
                                    }}
                                </p>
                            </a>
                        </div>
                    </div>
                    <div class="dataset-info--block">
                        <div class="dataset-info--sub-block">
                            <h2 class="dataset-info--subtitle">
                                Estimated Size:
                            </h2>
                        </div>
                        <div class="dataset-info--sub-block">
                            <p class="dataset-info--text">
                                {{ (currentState.size.estimatedSize ?
                                (currentState.size.estimatedSize | displaySize)
                                : "-") }}
                            </p>
                        </div>
                    </div>
                    <div class="dataset-info--block">
                        <div class="dataset-info--sub-block">
                            <h2 class="dataset-info--subtitle">Records:</h2>
                        </div>
                        <div class="dataset-info--sub-block">
                            <p class="dataset-info--text">
                                {{ currentState.size.numRecordsTotal || 0 |
                                number: "1.0-0" }}
                            </p>
                        </div>
                    </div>
                    <div class="dataset-info--block" *ngIf="currentState">
                        <div class="dataset-info--sub-block">
                            <h2 class="dataset-info--subtitle">Created At:</h2>
                        </div>
                        <div class="dataset-info--sub-block">
                            <app-display-time
                                class="dataset-info--text"
                                [title]="currentState.overview.createdAt"
                                [data]="currentState.overview.createdAt"
                            ></app-display-time>
                        </div>
                    </div>
                    <div class="dataset-info--block" *ngIf="currentState">
                        <div class="dataset-info--sub-block">
                            <h2 class="dataset-info--subtitle">
                                Last Updated At:
                            </h2>
                        </div>
                        <div class="dataset-info--sub-block">
                            <app-display-time
                                class="dataset-info--text"
                                [title]="currentState.overview.lastUpdatedAt"
                                [data]="currentState.overview.lastUpdatedAt"
                            ></app-display-time>
                        </div>
                    </div>
                    <div
                        class="dataset-info--block"
                        *ngIf="currentState && currentState.overview.metadata.currentWatermark"
                    >
                        <div class="dataset-info--sub-block">
                            <h2 class="dataset-info--subtitle">Watermark:</h2>
                        </div>
                        <div class="dataset-info--sub-block">
                            <app-display-time
                                class="dataset-info--text"
                                [title]="currentState.overview.metadata.currentWatermark"
                                [data]="currentState.overview.metadata.currentWatermark"
                            ></app-display-time>
                        </div>
                    </div>
                </ng-template>
            </div>
        </nav>
    </div>
</div>
